<!--
 * File:    index.html
 * Project: CSCE 315 Project 1, Spring 2018
 * Date:    03/22/18
 *
-->
<title>Team 50 API</title>
	
	<meta name="description" content="">
	
	<link rel="stylesheet" href="./style.css" >

	<style>
		html{background-color:#FFFFFF;color:#383838;}
		::-moz-selection{background:#444444;color:#DDDDDD;}
		::selection{background:#444444;color:#DDDDDD;}
		a{color:#0000FF;}
		.btn {
			border-radius:3px;
		}
		.btn-primary:hover,
		.btn-primary:active,
		.btn-primary.active,
		.btn-primary.disabled,
		.btn-primary[disabled] {
		  border-color: #500000 #500000 #d1d3d4;
		  background-color: #1d3362;
		}
		hr{border-top:1px solid #EBEBEB;border-bottom:1px solid #FFFFFF;}
		#documenter_sidebar, #documenter_sidebar ul a{background-color:#DDDDDD;color:#222222;}
		#documenter_sidebar ul a{-webkit-text-shadow:1px 1px 0px #EEEEEE;-moz-text-shadow:1px 1px 0px #EEEEEE;text-shadow:1px 1px 0px #EEEEEE;}
		#documenter_sidebar ul{border-top:1px solid #AAAAAA;}
		#documenter_sidebar ul a{border-top:1px solid #EEEEEE;border-bottom:1px solid #AAAAAA;color:#444444;}
		#documenter_sidebar ul a:hover{background:#500000;color:#DDDDDD;border-top:1px solid #444444;}
		#documenter_sidebar ul a.current{background:#444444;color:#DDDDDD;border-top:1px solid #444444;}
		#documenter_copyright{display:block !important;visibility:visible !important;}
	</style>
	
</head>
<body class="documenter-project-digi-woocommerce-theme-guide">
	<div id="documenter_sidebar">
		<ul id="documenter_nav">
			<li><a class="" href="#summary">Summary</a></li>
			<li><a href="#arduino" title="Arduino">Arduino</a></li>
			<li><a href="#PHP" title="PHP" class="">PHP</a></li>
			<li><a href="#python" title="Python" class="">Python</a></li>
            <li><a href="#citations" title="Citations & Sources" class="">Citations & Sources</a></li>
		</ul>
		
	</div>
	<div id="documenter_content">
	<section id="documenter_cover">
    <a name="summary"></a> 

        <h1><font color=#500000>Team 50 API</font></h1>

	<hr>
	<ul>
        <li>created: 01/27/2018</li>
        <li>latest update: 03/27/2018</li>
	</ul>
        <h5>The purpose of this project to track usage of the rec center's newly-opened South Entrance. The overall design uses an Arduino interface to measure the traffic, and send data to a web accessible page and database for further research.</h5>
    <p style="margin-left: 40px;"><h3>Equipment:</h3></p>
    <p style="margin-left: 40px;">
        <ul>
        <li>Arduino Uno</li>
        <li>Raspberry Pi 3, Model B</li>
        </ul>
    </p>
<p style="margin-left: 40px;"><h3>Using the Web Resources</h3></p>
<p><h5>The PedestrianCounter system currently uses a MySQL database backend with server-side PHP scripts to interface with the database. Because PedestrianCounter uses the PHP Object-Oriented DB connection style, the underlying database backend can be changed all in one place: Common.php.</h5></p>
<p><h5>Prerequisites for Pedestrian Counter:</h5></p>
        <ul>
        <li>Webserver that supports PHP 5 (5.4.16 currently used)</li>
        <li>Database with MySQL database client version: libmysql - mysqlnd 5.0.10</li>
        <li>PHPMyAdmin (4.4.15.10 currently used)</li>
        </ul>
<p><h5>Again, the flexible nature of the PHP Object-Oriented DB connection style makes changing databases relatively easy.</h5></p>
	</section>
	
	<section id="Arduino">
    <a name="arduino"></a> 
	<div class="page-header"><h3>Arduino</h3><hr class="notop"></div>
<p style="margin-left: 40px;">
	Basic description of Arduino API</p>
    <h4>Include Files:</h4>
    <p style="margin-left: 40px;">
	
    </p>
    </section>
        
    <section id="PHP">
    <a name="PHP"></a>
	<div class="page-header"><h3>PHP</h3><hr class="notop"></div>
<p style="margin-left: 40px;">
	The purpose of the following php files and functions is to facilitate communication between the data the arduino is recieving and the database.</p>
<h4>Classes:</h4>
<p style="margin-left: 40px;">
	<ul>
        <li><a href="#common" title="common">common.php</a></li>
        <li><a href="#error" title="error">error.php</a></li>
        <li><a href="#functions" title="functions">functions.php</a></li>
        <li><a href="#index" title="index">index.php</a></li>
        <li><a href="#testCases" title="testCases">testCases.php</a></li>
    </ul>
</p>
<a name="common"></a> 
<div class="page-header"><h3>common.php</h3></div>
<p style="margin-left: 40px;">
	This file contains the definition for the Common object, with its functions. It is used by any and all PHP files that need to connect to the PHPMyAdmin database for the 315 project 1. It also displays an error message if the page is accessed directly or through another program</p>
<h4>Includes:</h4>
<ul>
    <li>include('graphFunctions.php');</li>
</ul>
<h4>Field Summary:</h4>
<table id="fields" style="width:100%">
    
    <tr>
    <th>Type and Field</th>
    <th>Description</th> 
    </tr>
    <tr>
        <td>var $conn</td>
        <td>Connection</td> 
    </tr>
    <tr>
        <td>var $debug</td>
        <td>True/False value to indicate whether debug mode is activated</td> 
    </tr>
    <tr>
        <td>var $db</td>
        <td>Contains database path</td> 
    </tr>
    <tr>
        <td>var $dbname</td>
        <td>Contains the name of the database</td> 
    </tr>
    <tr>
        <td>var $user</td>
        <td>Contains the name of the user</td> 
    </tr>
    <tr>
        <td>var $pass</td>
        <td>Password to login to the database</td> 
    </tr>
</table>
<h4>Functions:</h4>
<ul>
<div class="info">
<li><h5>Common</h5></li>
    <p style="margin-left: 40px;"><strong>function Common($debug)</strong></p>
    <p style="margin-left: 40px;">Determines if the program should run in debug mode.</p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">debug- True/False value representing whether the program should run in debug mode or not</p></div>
    <br>
<div class="info">
<li><h5>connect</h5></li>
    <p style="margin-left: 40px;"><strong>function connect($db)</strong></p>
    <p style="margin-left: 40px;">Establishes a connection to the MySQL database server.</p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">db- database path</p></div>
    <br>
<div class="info">
<li><h5>executeQuery</h5></li>
    <p style="margin-left: 40px;"><strong>function executeQuery($sql, $filename)</strong></p>
    <p style="margin-left: 40px;">Executes a MySQL query</p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">sql- MySQL command</p>
    <p style="margin-left: 40px;">filename- File name</p></div>
    <br>
</ul>
    
<a name="error"></a> 
<div class="page-header"><h3>error.php</h3></div>
<p style="margin-left: 40px;">
	This file contains a way for displaying error information when a runtime error occurs.</p>

<a name="functions"></a> 
<div class="page-header"><h3>functions.php</h3></div>
<p style="margin-left: 40px;">
	This file contains the definition for the Common object, with its functions. It is used by any and all PHP files that need to connect to the PHPMyAdmin database for the 315 project 1.</p>
<h4>Field Summary:</h4>
<table id="fields" style="width:100%">
    
    <tr>
    <th>Type and Field</th>
    <th>Description</th> 
    </tr>
    <tr>
        <td>var $debug</td>
        <td>True/False value to indicate whether debug mode is activated</td> 
    </tr>
    <tr>
        <td>var $COMMON</td>
        <td>Common object from common.php</td> 
    </tr>
</table>
<h4>Functions:</h4>
<ul>
<div class="info">
<li><h5>insertIntoDatabase</h5></li>
    <p style="margin-left: 40px;"><strong>function insertIntoDatabase($table)</strong></p>
    <p style="margin-left: 40px;">This function takes one parameter and returns an error code.
           Error code 0: could not insert into database.
           Error code 1: successful insert into database.</p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">table- the name of the database table</p></div>
    <br>
<div class="info">
<li><h5>getNumDatabaseEntries</h5></li>
    <p style="margin-left: 40px;"><strong>function getNumDatabaseEntries($table)</strong></p>
    <p style="margin-left: 40px;">This function takes one parameter and returns the number
           of entries in the database. This number signifies the total
           number of people who have been detected by the Arduino
           since the database table was created.
           Return value will be a positive integer.</p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">table- the name of the database table</p></div>
    <br>
<div class="info">
<li><h5>sanitize</h5></li>
    <p style="margin-left: 40px;"><strong>function sanitize($str)</strong></p>
    <p style="margin-left: 40px;">This function takes one parameter and returns a "sanitized"
           version of that parameter.
           Return value will be another string with each of the non-
           alphanumeric characters removed. </p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">str- a string that contains any kind of characters.
           The characters can be numbers, letters, special characters,
        etc.</p></div>
    <br>
<div class="info">
<li><h5>handleArduinoPing</h5></li>
    <p style="margin-left: 40px;"><strong>function handleArduinoPing($key)</strong></p>
    <p style="margin-left: 40px;">This function takes one parameter and returns an
           integer error code. handleArduinoPing() is the script
           run by the webserver whenever the Arduino of the
           PedestrianCounter detects that somebody has walked by
           and sends a message to the webserver. This function
           will be called whenever a POST request is made to the
           webserver. The function ensures that a specific $key is
           provided in the body of the HTTP POST request before
           sending any information to the database.
           Error code 0: unable to handle Arduino ping (DB error).
           Error code -1: invalid key provided by Arduino.
           Error code 1: successful handle of Arduino ping. </p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">key- a string key from the Arduino.</p></div>
</ul>

<a name="index"></a> 
<div class="page-header"><h3>index.php</h3></div>
<p style="margin-left: 40px;">
	This file contains the index landing page for the 315 project 1. All GET and POST requests coming from the PedestrianCounter will be handled by this script. This file relies on the fact that the Arduino can send a  specially-crafted HTTP POST request to the server that no on else will know how to create.</p>

<a name="testCases"></a> 
<div class="page-header"><h3>testCases.php</h3></div>
<p style="margin-left: 40px;">This file contains functions that test each of the functions that will be implemented for the server-side logic. The functions under test can be found in functions.php. It also includes a simple HTML interface by which anyone can run an integration test on the functions and see the results. The testing page can be  found at: http://projects.cse.tamu.edu/domfabian1/testCases.php</p>
<h4>Field Summary:</h4>
<table id="fields" style="width:100%">
    
    <tr>
    <th>Type and Field</th>
    <th>Description</th> 
    </tr>
    <tr>
        <td>var $tablename</td>
        <td>Name of table</td> 
    </tr>
</table>
<h4>Functions:</h4>
<ul>
<div class="info">
<li><h5>makeTestButton</h5></li>
    <p style="margin-left: 40px;"><strong>function makeTestButton() </strong></p>
    <p style="margin-left: 40px;">This function generates some HTML for a testing button.</p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">None</p></div>
    <br>
<div class="info">
<li><h5>printTestResult</h5></li>
    <p style="margin-left: 40px;"><strong> function printTestResult($passCond)</strong></p>
    <p style="margin-left: 40px;">This function prints the pass/fail status of a test.</p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">passCond- pass/fail condition</p></div>
    <br>
<div class="info">
<li><h5>test_insertIntoDatabase</h5></li>
    <p style="margin-left: 40px;"><strong>function test_insertIntoDatabase()</strong></p>
    <p style="margin-left: 40px;">This function calls the insertIntoDatabase() function and
           checks that it actually creates a new row in the database.
           Both a valid $table name and an invalid $table name are
           supplied, which tests the function's ability to return each
           of its possible error codes.
           Pre-condition: connection to database established
           Post-condition: new entry made in database table</p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">none</p></div>
    <br>
<div class="info">
<li><h5>test_getNumDatabaseEntries</h5></li>
    <p style="margin-left: 40px;"><strong>function test_getNumDatabaseEntries()</strong></p>
    <p style="margin-left: 40px;">This function calls the getNumDatabaseEntries() function and
           checks that it returns an updated number of entries in the
           database each time a new entry is made.
           Pre-condition: connection to database established
           Post-condition: number of entries in table returned </p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">none.</p></div>
    <br>
<div class="info">
<li><h5>test_sanitize</h5></li>
    <p style="margin-left: 40px;"><strong>function test_sanitize()</strong></p>
    <p style="margin-left: 40px;">This function calls the sanitize() function and checks
           that it returns a string that is actually sanitized. A
           sanitized string should have only alphanumeric 
           characters in it. Any characters that are not either
           numbers or letters A-Z and a-z should not appear in the
           returned string of sanitize().
           Pre-condition: arbitrary string provided
           Post-condition: sanitized string returned </p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">none.</p></div>
    <br>
<div class="info">
<li><h5>test_handleArduinoPing</h5></li>
    <p style="margin-left: 40px;"><strong> function test_handleArduinoPing()</strong></p>
    <p style="margin-left: 40px;">This function calls the handleArduinoPing() handler
           function and ensures that it is able to make an entry
           in the database when a valid key is received. It will
           also ensure that proper error codes are returned in case
           of a failure.
           Pre-condition: connection to database established
           Post-condition: HTTP POST request handled by webserver,
                           new entry made in database table </p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">none.</p></div>
    <br>
<div class="info">
<li><h5>testAll</h5></li>
    <p style="margin-left: 40px;"><strong>function testAll()</strong></p>
    <p style="margin-left: 40px;">This function runs all the above tests.</p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">none.</p></div>
</ul>

</section>
        
<section id="Python">
    <a name=python></a>
<div class="page-header"><h3>Python</h3><hr class="notop"></div>
<p style="margin-left: 40px;">
	This code allows the Arduino Uno and Raspberry Pi to interact with the database</p>
    <h4>Classes:</h4>
<p style="margin-left: 40px;">
	<ul>
        <li><a href="#serverConnect.py" title="serverConnect.py">serverConnect.py</a></li>
        <li><a href="#testCases.py" title="testCases.py">testCases.py</a></li>
    </ul>
</p>
<a name="serverConnect.py"></a> 
<div class="page-header"><h3>serverConnect.py</h3></div>
<p style="margin-left: 40px;">
	This file contains all of the functions needed to handle connections between the Arduino and the webserver. The webserver acts as an intermediary between the Arduino and the database for security reasons.</p>
<h4>Imports:</h4>
<ul>
    <li>import socket</li>
    <li>from time import sleep</li>
</ul>
<h4>Field Summary:</h4>
<table id="fields" style="width:100%">
    
    <tr>
    <th>Type and Field</th>
    <th>Description</th> 
    </tr>
    <tr>
        <td>host</td>
        <td>Name of host</td> 
    </tr>
    <tr>
        <td>path</td>
        <td>Path for web address</td> 
    </tr>
    <tr>
        <td>secretKey</td>
        <td>Key to validate Arduino data</td> 
    </tr>
</table>
<h4>Functions:</h4>
<ul>
<div class="info">
<li><h5>isSuccessfulPing</h5></li>
    <p style="margin-left: 40px;"><strong>def isSuccessfulPing(response)</strong></p>
    <p style="margin-left: 40px;">This function takes a single parameter and returns a Boolean value. If the response contains the word "success", isSuccessfulPing() returns true. Otherwise, false.
        <br>
    Pre-conditions: none.
        <br>
    Post-conditions: same as before function called.</p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">response- a string response from the webserver that contains either the word "success" or the word "failure" at the end of the response</p></div>
    <br>
<div class="info">
<li><h5>sendWebServerPing</h5></li>
    <p style="margin-left: 40px;"><strong>def sendWebserverPing(host, path, secretKey)</strong></p>
    <p style="margin-left: 40px;">This function takes three string parameters: 'host','path', and 'secretKey'. 'secretKey'. sendWebserverPing() returns an integer as a status code: 
        <br>
        status code 0: failed to send message to the webserver.
        <br>
        status code 1: successful message sent to webserver.
        <br>
    Pre-conditions: socket library imported and time.sleep() function imported.
        <br>
    Post-conditions: database has one more entry in it than before, corresponding to the message sent.</p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">host-represents the base URL of the webserver's domain name like "example.com" </p>
    <p style="margin-left: 40px;">path-represents the path on the domain that leads to the webserver like "about/info/page" </p>
    <p style="margin-left: 40px;">secretKey-is the secret Arduino key that insulates our database from any old person trying to insert into our database" </p></div>
    <br>
</ul>

<a name="testCases.py"></a> 
<div class="page-header"><h3>testCases.py</h3></div>
<p style="margin-left: 40px;">
	This file contains all of the functions that test the functions found in serverConnect.py.</p>
<h4>Imports:</h4>
<ul>
    <li>from serverConnect import *</li>
</ul>
<h4>Field Summary:</h4>
<table id="fields" style="width:100%">
    
    <tr>
    <th>Type and Field</th>
    <th>Description</th> 
    </tr>
    <tr>
        <td>host</td>
        <td>Name of host (defined in serverConnect.py)</td> 
    </tr>
    <tr>
        <td>path</td>
        <td>Path for web address (defined in serverConnect.py)</td> 
    </tr>
    <tr>
        <td>secretKey</td>
        <td>Key to validate Arduino data (defined in serverConnect.py)</td> 
    </tr>
</table>
<h4>Functions:</h4>
<ul>
<div class="info">
<li><h5>test_sendWebserverPing</h5></li>
    <p style="margin-left: 40px;"><strong>def test_sendWebserverPing(host, path, secretKey)</strong></p>
    <p style="margin-left: 40px;">This function tests the sendWebserverPing() function using the global variables declared in the serverConnect.py file. It takes the same three parameters as the actual sendWebserverPing() function.</p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">host-represents the base URL of the webserver's domain name like "example.com" </p>
    <p style="margin-left: 40px;">path-represents the path on the domain that leads to the webserver like "about/info/page" </p>
    <p style="margin-left: 40px;">secretKey-is the secret Arduino key that insulates our database from any old person trying to insert into our database" </p></div>
    <br>
<div class="info">
<li><h5>test_isSuccessfulPing</h5></li>
    <p style="margin-left: 40px;"><strong>def test_isSuccessfulPing()</strong></p>
    <p style="margin-left: 40px;">This function tests the isSuccessfulPing() function by using three test strings. </p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">none</p></div>
    <br>
<div class="info">
<li><h5>testAll</h5></li>
    <p style="margin-left: 40px;"><strong>def testAll()</strong></p>
    <p style="margin-left: 40px;">This function runs all of the above tests using global variables defined in serverConnect.py. </p>
    <p style="margin-left: 40px;"><strong>Parameters:</strong></p>
    <p style="margin-left: 40px;">none</p></div>
    <br>
</ul>


</section>
<section id="Citations & Sources">
<a name="citations"></a>
<div class="page-header"><h3>Citations & Sources</h3><hr class="notop"></div>
    <ul>
        <li><strong>graphs.php</strong> fusioncharts.php and fusioncharts.js are used under non-commercial license from Fusion Charts Technologies: <a href="https://github.com/fusioncharts">https://github.com/fusioncharts</a>.</li>
        <li><strong>style.css</strong> Some elements of stylesheet extended from documenter class copyright Xaver Birsak: <a href="https://revaxarts-themes.com/documenter/docs/">https://revaxarts-themes.com/documenter/docs/</a></li>
    </ul>
</section>
</div>

</body></html>